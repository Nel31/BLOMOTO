!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).k={})}(this,(function(e){"use strict";var t,n,i;!function(e){e.momo="momo",e.card="card",e.wallet="wallet"}(t||(t={})),function(e){e.BJ="BJ",e.CI="CI",e.SN="SN",e.TG="TG",e.NE="NE"}(n||(n={})),e.ListenerEventName=void 0,(i=e.ListenerEventName||(e.ListenerEventName={})).NETWORK_STATE_CHANGED="NETWORK_STATE_CHANGED",i.INIT_WIDGET="INIT_WIDGET",i.WIDGET_SUCCESSFULLY_INIT="WIDGET_SUCCESSFULLY_INIT",i.CLOSE_WIDGET="CLOSE_WIDGET",i.DESTROY_WIDGET="DESTROY_WIDGET",i.WIDGET_SUCCESSFULLY_DESTROYED="WIDGET_SUCCESSFULLY_DESTROYED",i.PAYMENT_INIT="PAYMENT_INIT",i.PAYMENT_ABORTED="PAYMENT_ABORTED",i.PENDING_PAYMENT="PENDING_PAYMENT",i.ON_USER_FEEDBACK="ON_USER_FEEDBACK",i.PAYMENT_FAILED="PAYMENT_FAILED",i.PAYMENT_SUCCESS="PAYMENT_SUCCESS",i.PAYMENT_END="PAYMENT_END",i.RETRY_PAYMENT="RETRY_PAYMENT",i.WAVE_LINK="WAVE_LINK";const a={},d={UI_APP_DEV:"https://widget-v3.kkiapay.me",UI_APP_CDN_LINK:"https://cdn.kkiapay.me/k.js"},o=["amount","sandbox","position","theme","paymentmethod","paymentMethods","providers","fullname","name","email","phoneNumber","phone","data","key","sdk","url","callback","successCallback","failed_callback","buttontext","direct","split","partnerid","partnerId","apikey","api_key","publicAPIKey","countries"],r={phone:"phoneNumber",name:"fullname",paymentmethod:"paymentMethods",apikey:"key",successCallback:"callback",publicAPIKey:"key",api_key:"key",partnerid:"partnerId"},s=["countries","paymentMethods"];function E(e){const t=e.split("-");return t[0]+t.slice(1).map((e=>e.charAt(0).toUpperCase()+e.slice(1))).join("")}function c(e){const t=JSON.parse(JSON.stringify(e));if(""===t)return t;if(Number.isNaN(Number(t))){if("false"===t)return!1;if("true"===t)return!0;if(t.indexOf(",")>-1){return t.split(" ").join("").split(",")}return t}return Number(t)}class l extends HTMLElement{constructor(){super();const e=this.attachShadow({mode:"open"});let t,n=document.createElement("button");n.innerHTML="en"===window.navigator.language.split("-")[0]?"Pay now":"Payer maintenant",n.setAttribute("style","\n        background-color: #4661b9;\n        color: white;\n        padding: 10px 20px;\n        font-size: 16px;\n        border: none;\n        border-radius: 5px;\n        cursor: pointer;\n      "),e.appendChild(n),setTimeout((()=>{t=Object.freeze({...this})}),100),n.addEventListener("click",(()=>{window.openKkiapayWidget(t)}))}static get observedAttributes(){return o}attributeChangedCallback(e,t,n){if(null!==t)return;if(this[E(e)]=n,!this.shadowRoot)return;const i=this.shadowRoot.querySelector("button");i&&(e===E("buttontext")&&n&&(i.innerHTML=n),"class"===e&&n&&i.setAttribute("class",n))}}let p,u=()=>{};const N=t=>{t=function(e){const t={...e};for(let e in r)t[e]&&(t[r[e]]=t[e],delete t[e]);for(let e in t){if(["data","paymentMethods","countries"].includes(e)){try{t[e]=JSON.parse(JSON.stringify(t[e]))}catch(e){}s.includes(e)&&(t[e]=Array.isArray(c(t[e]))?c(t[e]):[c(t[e])],"paymentMethods"===e)&&t.paymentMethods.find((e=>!["momo","card","direct_debit"].includes(e)))&&(t.paymentMethods=["momo","card","direct_debit"])}"amount"===e&&(t[e]=Number(t[e])),"phoneNumber"===e&&(t[e]=String(t[e])),"sandbox"===e&&"boolean"!=typeof t.sandbox&&("true"===t.sandbox?t.sandbox=!0:(t.sandbox,t.sandbox=!1)),"position"!==e||["left","right","center"].includes(t[e])||(t[e]="center")}return t}(t);const n=p.contentWindow;n&&n.postMessage({name:e.ListenerEventName.INIT_WIDGET,data:{...t,host:window.location.href,...a}},d.UI_APP_DEV)};(()=>{const e=(new Date).getTime();p=document.createElement("iframe"),p.style.cssText=`\n    display: block;\n    height: 100dvh; \n    width: 100%; \n    position: fixed;\n    top: 0;\n    left: 0;\n    z-index: ${e};`,p.src=d.UI_APP_DEV,p.setAttribute("frameborder","0"),p.addEventListener("load",(()=>u()))})();const m=e=>{u=()=>N(e),document.body.appendChild(p)},_=()=>p.remove(),T=e=>window.open(e,"_blank")?.focus(),w=(()=>{const t={[e.ListenerEventName.CLOSE_WIDGET]:_,[e.ListenerEventName.WAVE_LINK]:T};for(const n in e.ListenerEventName)t[n]||(t[n]=()=>{});return t})();window.addEventListener("load",(()=>(()=>{const e=document.querySelector(".kkiapay-button"),t=document.querySelector(`script[src="${d.UI_APP_CDN_LINK}"]`);if(t&&e){let n={};for(let e of o){const i=t.getAttribute(e);i&&(n[e]=i)}e.addEventListener("click",(()=>{m(n)}))}})())),window.addEventListener("message",(e=>{e.data&&w[e.data.name]&&w[e.data.name](e.data.data)}));const y=e=>{w.INIT_WIDGET=e},L=e=>{w.CLOSE_WIDGET=()=>{_(),e()}},I=e=>{w.DESTROY_WIDGET=e},A=e=>{w.PAYMENT_INIT=e},b=e=>{w.PAYMENT_ABORTED=e},f=e=>{w.PENDING_PAYMENT=e},S=e=>{w.ON_USER_FEEDBACK=e},k=e=>{w.PAYMENT_SUCCESS=e},D=e=>{w.PAYMENT_FAILED=e},P=e=>{w.PAYMENT_END=e},h=e=>{w.NETWORK_STATE_CHANGED=e},C=(e,t)=>{w[`PAYMENT_${e.toUpperCase()}`]=t},g=e=>{w[`PAYMENT_${e.toUpperCase()}`]=()=>{}};window.openKkiapayWidget=m,window.closeKkiapayWidget=_,window.addWidgetInitListener=y,window.addKkiapayCloseListener=L,window.addWidgetDestroyedListener=I,window.addPaymentInitListener=A,window.addPaymentEndListener=P,window.addPaymentAbortedListener=b,window.addFeedbackListener=S,window.addPendingListener=f,window.addFailedListener=D,window.addSuccessListener=k,window.onNetworkStateChanged=h,window.addEventListener=addEventListener,window.addKkiapayListener=C,window.removeKkiapayListener=g,window.customElements.get("kkiapay-widget")||window.customElements.define("kkiapay-widget",l),e.addFailedListener=D,e.addFeedbackListener=S,e.addKkiapayCloseListener=L,e.addKkiapayListener=C,e.addPaymentAbortedListener=b,e.addPaymentEndListener=P,e.addPaymentInitListener=A,e.addPendingListener=f,e.addSuccessListener=k,e.addWidgetDestroyedListener=I,e.addWidgetInitListener=y,e.closeKkiapayWidget=_,e.focusWaveLink=T,e.onNetworkStateChanged=h,e.openKkiapayWidget=m,e.removeKkiapayListener=g,Object.defineProperty(e,"__esModule",{value:!0})}));
